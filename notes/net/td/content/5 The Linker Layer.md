## 链路层概述
1. 术语
    1. 节点: host and Router
    2. 链路: 沿着通信路径连接相邻节点的通信信道
    3. 帧: 数据链路层的分组单元
2. 数据链路层负责将数据报通过链路从一个节点传输到物理上相邻的下一个节点
3. 数据报在不同链路上可能由不同的链路层协议进行处理
4. 不同的链路层协议可能提供不同的服务
5. 链路提供的服务
    1. 成帧 、链路访问
        1. 将数据加上头部和尾部，封装成数据帧
        2. 共享介质的信道访问
        3. 帧头部用MAC地址标识源和目的（不同于IP地址）
    2. 可靠传递
        1. 很少用于误码率低的链路（光纤、双绞线链路）
        2. 用于误码率高的链路（无线链路）
    3. 流量控制
    4. 差错检测
        1. 信号衰减和电磁干扰噪声导致出错
        2. 接收方检测到错误存在：
        3. 给发送方发送信号要求重传或丢弃该数据帧
    5. 差错纠正
        1. 接收方检测和纠正帧中错误，不用重传
    6. 半双工和全双工
        1. 半双工时，链路两端的节点都能传输分组，但不能同时传输
## 差错检测和纠正技术
## 多路访问链路和协议
1. 两种链路:
    1. 点到点链路 point-to-point protocol
    2. 广播链路(共享线路或介质)
2. 多址访问协议
    1. 分布式算法决定节点如何共享信道，如节点何时可以传输数据
    2. 没有额外信道进行协调
3. 理想的多址访问协议需满足：
    1. (假设传播速率为R)当只有一个节点有数据发送时，该节点的吞吐量为R, 当M个节点有数据发送时，每个节点吞吐量为R/M
    2. 分散
        1. 没有特定节点用于调整传输
        2. 没有时钟同步
    3. 简单
4. 多址访问协议分类
    1. 信道划分协议 将信道划分成小的“片”（时隙、频率、编码） 将“片”分配给节点使用
    2. 随机访问协议 信道没有被分割，允许碰撞, 碰撞恢复
    3. 轮流协议
    节点轮流传送，但数据量大的节点轮流更长时间

5. 随机访问协议
    1. 当节点有数据发送时
        1. 以信道全部速率R传输
        2. 没有主节点起协调作用
    2. 需要解决的问题:
        1. 如何检测碰撞
        2. 如何从碰撞中间回复
    3. ALOHA
        1. 纯ALOHA 技术: 
        P(给定节点成功概率) =  P(给定节点传送) .  
                            P(在 [t0-1,t0]没有其它节点传送 ).
                           P(在 [t0,t0+1]没有其它节点传送)  
        2. 时隙ALOHA: 所有节点发送的时候只有从时隙的开始 
        P(给定节点成功概率) = P(给定节点传送). P(没有其它节点传送 )  
                         = p . (1-p)N-1 
    4. CSMA(Carrier Sense Multiple Access)
        1. 非坚持(non-persistent)CSMA  
            一旦监听到信道忙（即发现有其他站在发送数据），就不再坚持听下去，而是根据协议的算法延迟一个随机的时间后重新再监听。若进行载波监听时发现信道空闲，则将准备好的帧发送出去。
        2. 时隙非坚持CSMA  
            采用划分时隙的随机接入CSMA协议，协议规定只能在每个时隙开始时才能发送帧。
        3. 1坚持  
            当一个站点要传送数据时，首先侦听信道，看是否有其他站点正在传送。如果信道正忙，它就持续等待直到它侦听到信道空闲时，便将数据送出。若发生冲突，站点就等待一个随机长的时间，然后重新开始。
        4. p坚持
            当一个站点要传送数据时，首先侦听信道，看是否有其他站点正在传送。如果信道正忙，它就持续等待直到它侦听到信道空闲时，以概率P发送数据，而以概率（1－P）延迟一段时间τ(网络中最远的端到端的传播时延)，重新监听信道。若发生冲突，站点就等待一个随机长的时间，然后重新开始。
        5. 比较
            1. 非坚持：不能充分利用信道刚刚转入空闲期的这段时间。
            2. 1坚持：容易在上述这段时间产生冲突.(所有人同时发现没有发送, 开始同时发送数据, 所以容易冲突)
            3. P坚持：可以在一定程度上克服这些缺点，但却很难选择一个能用于各种通信量强度的P值。所以在实际网络中常选择1坚持。
    5. CSMA/CD
        1. 碰撞后停止传输，减少信道浪费 
        2. 强化碰撞
        3. 争用期
            1. 最先发送数据帧的站，在发送数据帧后至多经过时间 2t（两倍的端到端往返时延）就可知道发送的数据帧是否遭受了碰撞
            2. 以太网的端到端往返时延 2t 称为争用期，或碰撞窗口
            3. 经过争用期这段时间还没有检测到碰撞，才能肯定这次发送不会发生碰撞

6. 轮流协议
    1. 比较之前的协议 =>信道划分: 轻载的时候浪费 随机访问协议: 重载的时候碰撞开销
    2. 轮讯协议: 主节点邀请从节点轮流传输
        1. 轮训开销
        2. 等待时间
        3. 单点失效
    3. 令牌传递协议: 控制令牌依次通过各个结点
        1. 令牌的开销
        2. 等待时间
        3. 单点失效(token)
## 局域网
1. MAC地址 : MAC地址是平面地址, MAC地址在不同网络之间迁移的时候不会发生改变
2. 地址解析协议(ARP): 根据目标的 IP 地址获取其 MAC 地址
    1. 同一个局域网中间运行
        1. 建立ARP请求包：MAC报头 IP报头 
        2. 广播ARP请求包
        3. 目的发送ARP应答包
        4. 更新ARP高速缓存
    2. 不同局域网中间路由
        1. 源头目标IP地址保持不变
        2. MAC地址使用路由器
  
3. 以太网
    1. 以太网类型
        1. 交换式以太网
        2. 总线式以太网
    2. 以太网的帧结构
        1. 数据字段:（46字节，1500字节）
        2. 总共8字节，前7 字节的格式为 10101010 ，最后一个字节格式为10101011 用于同步发送方与接收方时钟
    3. 以太网提供的服务
        1. 无连接服务: 在送适配器和接收适配器之间不需要握手
        2. 不可靠服务: 接收适配器不发送确认帧或否认帧给发送方
    4. 以太网使用的CSMA/CD
        1. 特点
            1. 没有时隙
            2. 当适配器侦听到其它适配器在传输，则它不传输帧, 即载波侦听
            3. 正在传输的适配器若检测到其它适配器也在传输，则它中止自己的传输, 即碰撞检测
            4. 在重新传输之前，适配器要等待一段随机时间，即随机回退
        2. 算法
            1. 适配器收到来自网络层的数据报，创建帧
            2. 若适配器检测到信道空闲，则开始传输帧；若检测到信道忙，就开始等待，直到信道空闲再开始传输该帧
            3. 若适配器传输了整个帧而没有检测到其它适配器的传输，则该适配器完成该帧的传输
            4. 若适配器在传输时检测到其它适配器也在传输，则停止传输，发送拥塞信号
            5. 中止传输后，适配器进入指数回退阶段，在经历第m次碰撞后，适配器随机从{0,1,2,…,2m-1}中选择K值。适配器在等待 K·512比特时间后，返回第2步
        3. 重要特性
            1. 使用 CSMA/CD 协议的以太网不能进行全双工通信而只能进行双向交替通信（半双工通信）。
            2. 每个站在发送数据之后的一小段时间内，存在着遭遇碰撞的可能性。 
            3. 这种发送的不确定性使整个以太网的平均通信量远小于以太网的最高数据率
    5. 拥塞信号:  用来确保所有传输者都能检测到碰撞而传输的信号；48比特长
    6. 比特时间: 传输一个bit 所需要的时间
    7. 指数回退算法: 适配器重传时试图估计正确的负载
    8. 争用期长度: 
    9. 最短有效帧长
    10. 曼彻斯特编码
    11. 差分曼彻斯特编码
    12. 集线器（或转发器）互联
        1. 主干集线器将LAN网段互联起来
        2. 扩展了节点间的最大距离
        3. 原先独立的网段碰撞域变成了一个大的碰撞域
        4. 不能将10BaseT 和 100BaseT以太网互联
    13. 网桥互联 : 网桥（Bridge）实质上就是一种存储—转发设备，用来实现 MAC 层的 LAN 互连
        1. 网桥的工作原理
            1. 不断监听各端口是否有信号
            2. 收到无差错的帧则缓存，反之将差错帧丢弃
            3. 若所收帧的目的MAC地址属另一网段，则通过站表决定向何端口转发
            4. 网桥不转发同一网段内通信的帧
            5. 网桥不修改所转发的帧的源地址
        2. 网桥的优势
            1. 过滤通信量
            2. 扩大了局域网的物理范围
            3. 提高了可靠性
            4. 可互连不同物理层、不同MAC子层和不同速率的局域网
        3. 网桥的缺点
            1. 由于要接收和转发，增加了时延
            2. MAC子层没有流量控制功能，网络负荷重时，网桥缓存空间可能发生溢出，产生帧丢失现象
            3. 不同MAC子层的网段桥接时，在转发帧之前要修改帧的某些字段，这也需要耗费时间
            4. 出现广播风暴。网桥只适合用户少于几百个和通信量不太大的局域网，否则有时会因传播过多广播信息而产生网络拥塞
        4. 透明网桥选路原理
            1. 差错检查
            2. 不需要转发丢弃
            3. 定时更新
            4. 源站登记
        5. 支撑树算法: 防止出现循环
    14. 以太网交换机——多端口网桥
        1. 链路层设备
            1. 当帧转发到LAN网段, 用CSMA/CD 访问 LAN网段
        2. 直通交换: 帧从入端口转发到出端口不需收集整个帧
        3. 和路由器比较: 
            1. 路由器：网络层设备 (检查网络层头部), 交换机为链路层设备
            2. 路由器维护路由表, 实现路由算法
            3. 交换机维护交换表，实现MAC地址过滤、学习算法
    15. 


## Note
1. 路由器 或者 主机存储 ARP表

## 问题
1. 以太网的帧结构 中间前面同步码, 用来做什么, 什么叫做格式
2. 曼彻斯特编码的原理
3. 关于争用期的计算, 到底是规定, 还是什么 ?
4. 集线器 vs 以太网交换机 vs 路由器 的比较表是什么东西 ?
